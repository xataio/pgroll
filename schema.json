{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$ref": "#/definitions/PgRollMigration",
  "$defs": {
    "CheckConstraint": {
      "additionalProperties": false,
      "properties": {
        "constraint": {
          "type": "string",
          "description": "Constraint expression"
        },
        "name": {
          "type": "string",
          "description": "Name of check constraint"
        }
      },
      "required": ["constraint", "name"],
      "type": "object"
    },
    "Column": {
      "description": "Column definition",
      "properties": {
        "check": {
          "$ref": "#/definitions/CheckConstraint",
          "description": "Check constraint for the column"
        },
        "default": {
          "type": "string",
          "description": "Default value for the column"
        },
        "name": {
          "type": "string",
          "description": "Name of the column"
        },
        "nullable": {
          "type": "boolean",
          "description": "Indicates if the column is nullable"
        },
        "pk": {
          "type": "boolean",
          "description": "Indicates if the column is part of the primary key"
        },
        "references": {
          "$ref": "#/definitions/ForeignKeyReference",
          "description": "Foreign key constraint for the column"
        },
        "type": {
          "type": "string",
          "description": "Postgres type of the column"
        },
        "unique": {
          "type": "boolean",
          "description": "Indicates if the column values must be unique"
        }
      },
      "required": ["name", "nullable", "pk", "type", "unique"],
      "type": "object"
    },
    "ForeignKeyReference": {
      "additionalProperties": false,
      "properties": {
        "column": {
          "type": "string",
          "description": "Name of the referenced column"
        },
        "name": {
          "type": "string",
          "description": "Name of the foreign key constraint"
        },
        "table": {
          "type": "string",
          "description": "Name of the referenced table"
        }
      },
      "required": ["column", "name", "table"],
      "type": "object"
    },
    "OpAddColumn": {
      "additionalProperties": false,
      "properties": {
        "column": {
          "$ref": "#/definitions/Column",
          "description": "Column to add"
        },
        "table": {
          "type": "string",
          "description": "Name of the table"
        },
        "up": {
          "type": "string",
          "description": "SQL expression for up migration"
        }
      },
      "required": ["column", "table"],
      "type": "object"
    },
    "OpAlterColumn": {
      "additionalProperties": false,
      "properties": {
        "check": {
          "$ref": "#/definitions/CheckConstraint",
          "description": "Add check constraint to the column"
        },
        "column": {
          "type": "string",
          "description": "Name of the column"
        },
        "down": {
          "type": "string",
          "description": "SQL expression for down migration"
        },
        "name": {
          "type": "string",
          "description": "New name of the column (for rename column operation)"
        },
        "nullable": {
          "type": "boolean",
          "description": "Indicates if the column is nullable (for add not null constraint operation)"
        },
        "references": {
          "$ref": "#/definitions/ForeignKeyReference",
          "description": "Add foreign key constraint to the column"
        },
        "table": {
          "type": "string",
          "description": "Name of the table"
        },
        "type": {
          "type": "string",
          "description": "New type of the column (for change type operation)"
        },
        "unique": {
          "$ref": "#/definitions/UniqueConstraint",
          "description": "Add unique constraint to the column"
        },
        "up": {
          "type": "string",
          "description": "SQL expression for up migration"
        }
      },
      "required": ["column", "down", "name", "table", "type", "up"],
      "type": "object"
    },
    "OpCreateIndex": {
      "additionalProperties": false,
      "properties": {
        "columns": {
          "items": {
            "type": "string"
          },
          "type": "array",
          "description": "Names of columns on which to define the index"
        },
        "name": {
          "type": "string",
          "description": "Index name"
        },
        "table": {
          "type": "string",
          "description": "Name of table on which to define the index"
        }
      },
      "required": ["columns", "name", "table"],
      "type": "object",
      "description": "Create index operation"
    },
    "OpCreateTable": {
      "additionalProperties": false,
      "properties": {
        "columns": {
          "items": {
            "$ref": "#/definitions/Column",
            "description": "Columns to add to the table"
          },
          "type": "array"
        },
        "name": {
          "type": "string",
          "description": "Name of the table"
        }
      },
      "required": ["columns", "name"],
      "type": "object"
    },
    "OpDropColumn": {
      "additionalProperties": false,
      "properties": {
        "column": {
          "type": "string",
          "description": "Name of the column"
        },
        "down": {
          "type": "string",
          "description": "SQL expression for down migration"
        },
        "table": {
          "type": "string",
          "description": "Name of the table"
        }
      },
      "required": ["column", "table"],
      "type": "object"
    },
    "OpDropConstraint": {
      "additionalProperties": false,
      "properties": {
        "column": {
          "type": "string",
          "description": "Name of the column"
        },
        "down": {
          "type": "string",
          "description": "SQL expression for down migration"
        },
        "name": {
          "type": "string",
          "description": "Name of the constraint"
        },
        "table": {
          "type": "string",
          "description": "Name of the table"
        },
        "up": {
          "type": "string",
          "description": "SQL expression for up migration"
        }
      },
      "required": ["column", "down", "name", "table", "up"],
      "type": "object"
    },
    "OpDropIndex": {
      "additionalProperties": false,
      "properties": {
        "name": {
          "type": "string",
          "description": "Index name"
        }
      },
      "required": ["name"],
      "type": "object"
    },
    "OpDropTable": {
      "additionalProperties": false,
      "properties": {
        "name": {
          "type": "string",
          "description": "Name of the table"
        }
      },
      "required": ["name"],
      "type": "object"
    },
    "OpRawSQL": {
      "additionalProperties": false,
      "properties": {
        "down": {
          "default": "",
          "type": "string",
          "description": "SQL expression for down migration"
        },
        "up": {
          "type": "string",
          "description": "SQL expression for up migration"
        }
      },
      "required": ["up"],
      "type": "object"
    },
    "OpRenameTable": {
      "additionalProperties": false,
      "properties": {
        "from": {
          "type": "string",
          "description": "Old name of the table"
        },
        "to": {
          "type": "string",
          "description": "New name of the table"
        }
      },
      "required": ["from", "to"],
      "type": "object"
    },
    "OpSetReplicaIdentity": {
      "additionalProperties": false,
      "properties": {
        "identity": {
          "$ref": "#/definitions/ReplicaIdentity",
          "description": "Replica identity to set"
        },
        "table": {
          "type": "string",
          "description": "Name of the table"
        }
      },
      "required": ["identity", "table"],
      "type": "object"
    },
    "PgRollMigration": {
      "additionalProperties": false,
      "properties": {
        "name": {
          "type": "string",
          "description": "Name of the migration"
        },
        "operations": {
          "items": {
            "anyOf": [
              {
                "$ref": "#/definitions/OpAddColumn",
                "description": "Add column operation"
              },
              {
                "$ref": "#/definitions/OpAlterColumn",
                "description": "Alter column operation"
              },
              {
                "$ref": "#/definitions/OpCreateIndex",
                "description": "Create index operation"
              },
              {
                "$ref": "#/definitions/OpCreateTable",
                "description": "Create table operation"
              },
              {
                "$ref": "#/definitions/OpDropColumn",
                "description": "Drop column operation"
              },
              {
                "$ref": "#/definitions/OpDropConstraint",
                "description": "Drop constraint operation"
              },
              {
                "$ref": "#/definitions/OpDropIndex",
                "description": "Drop index operation"
              },
              {
                "$ref": "#/definitions/OpDropTable",
                "description": "Drop table operation"
              },
              {
                "$ref": "#/definitions/OpRawSQL",
                "description": "Raw SQL operation"
              },
              {
                "$ref": "#/definitions/OpRenameTable",
                "description": "Rename table operation"
              },
              {
                "$ref": "#/definitions/OpSetReplicaIdentity",
                "description": "Set replica identity operation"
              }
            ]
          },
          "type": "array"
        }
      },
      "required": ["name", "operations"],
      "type": "object"
    },
    "ReplicaIdentity": {
      "additionalProperties": false,
      "properties": {
        "Index": {
          "type": "string",
          "description": "Name of the index to use as replica identity"
        },
        "Type": {
          "type": "string",
          "description": "Type of replica identity"
        }
      },
      "required": ["Index", "Type"],
      "type": "object"
    },
    "UniqueConstraint": {
      "additionalProperties": false,
      "properties": {
        "name": {
          "type": "string",
          "description": "Name of unique constraint"
        }
      },
      "required": ["name"],
      "type": "object"
    }
  }
}
